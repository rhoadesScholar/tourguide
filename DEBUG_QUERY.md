# Query Agent Debug Tool

Command-line tool for testing the query agent without the web interface.

## Usage

### Interactive Mode (recommended)
```bash
pixi run python debug_query.py
```

Then enter queries at the prompt:
```
Query> How many mitochondria are there?
Query> What is the average volume of lysosomes?
Query> Take me to the largest nucleus
Query> quit
```

### Single Query Mode
```bash
pixi run python debug_query.py "Your query here"
```

Examples:
```bash
pixi run python debug_query.py "How many mitochondria are there?"
pixi run python debug_query.py "Take me to the largest mito"
pixi run python debug_query.py "What is the average peroxisome volume?"
```

## What It Shows

For each query, you'll see:

1. **GENERATED SQL** - The SQL query generated by the AI agent
2. **DATABASE RESULTS** - Raw results from the database
3. **QUERY TYPE** - "navigation" or "informational"
4. **NAVIGATION INFO** - Position/scale/object_id (for navigation queries)
5. **FINAL ANSWER** - Human-readable response

## Example Output

```
================================================================================
QUERY: Take me to the largest mito
================================================================================

[1] Processing query...
[QUERY_AGENT] Generated SQL: SELECT object_id, volume, position_x, position_y, position_z FROM organelles WHERE organelle_type='mitochondria' ORDER BY volume DESC LIMIT 1;

--------------------------------------------------------------------------------
GENERATED SQL:
--------------------------------------------------------------------------------
SELECT object_id, volume, position_x, position_y, position_z FROM organelles WHERE organelle_type='mitochondria' ORDER BY volume DESC LIMIT 1;

--------------------------------------------------------------------------------
DATABASE RESULTS:
--------------------------------------------------------------------------------
  Result:
    object_id: mitochondria_371
    volume: 8721063936.0
    position_x: 31186.98134386892
    position_y: 16107.79190725382
    position_z: 5090.221098777647

--------------------------------------------------------------------------------
QUERY TYPE:
--------------------------------------------------------------------------------
  navigation

--------------------------------------------------------------------------------
NAVIGATION INFO:
--------------------------------------------------------------------------------
  Position: [31186, 16107, 5090]
  Scale: 300
  Object ID: mitochondria_371

--------------------------------------------------------------------------------
FINAL ANSWER:
--------------------------------------------------------------------------------
  Taking you to organelle mitochondria_371 with volume 8721063936.0

================================================================================
```

## Benefits

- No need to start the web server
- No audio generation
- No Neuroglancer visualization
- See exactly what SQL is generated
- See raw database results
- Debug query formulation
- Fast iteration for testing

## Configuration

Uses the same `.env` configuration as the main server:
- `ORGANELLE_CSV_PATHS` - CSV files to import
- `ORGANELLE_DB_PATH` - Database location
- `QUERY_AI_MODEL` - Ollama model to use (default: nemotron)
